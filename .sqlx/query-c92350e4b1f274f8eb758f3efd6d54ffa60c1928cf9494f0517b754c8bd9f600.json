{
  "db_name": "PostgreSQL",
  "query": "\n            select s.price * p.usd_price as \"usd_price?\",\n                   s.address             as \"address!\",\n                   s.created             as \"created!\",\n                   s.updated             as \"updated!\",\n                   s.tx_lt               as \"tx_lt!\",\n                   s.nft                 as \"nft!\",\n                   s.collection          as \"collection?\",\n                   s.buyer               as \"buyer?\",\n                   s.price_token         as \"price_token!\",\n                   s.price               as \"price!\",\n                   s.finished_at         as \"finished_at?\",\n                   s.expired_at          as \"expired_at?\",\n                   case\n                       when s.state = 'active'::direct_buy_state and to_timestamp(0::double precision) < s.expired_at and\n                            s.expired_at < now()::timestamp then 'expired'::direct_buy_state\n                       else s.state end  as \"state!: _\",\n                   1::bigint             as \"cnt!\",\n                   fee_numerator,\n                   fee_denominator\n            from nft_direct_buy s\n                     join offers_whitelist ow on ow.address = s.address\n                     left join token_usd_prices p on s.price_token = p.token\n                     left join lateral ( select ((ne.args -> 'fee') -> 'numerator')::integer   as fee_numerator,\n                                                ((ne.args -> 'fee') -> 'denominator')::integer as fee_denominator\n                                         from nft_events ne\n                                         where ne.event_type = 'market_fee_changed'::event_type\n                                           and (ne.args ->> 'auction') = s.address) ev on true\n            where s.buyer = $1\n              and s.nft = $2\n              and s.state = 'active'::direct_buy_state\n              and (to_timestamp(0::double precision) = s.expired_at or s.expired_at > now()::timestamp)\n            order by 1 desc\n            limit 1\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "usd_price?",
        "type_info": "Numeric"
      },
      {
        "ordinal": 1,
        "name": "address!",
        "type_info": "Varchar"
      },
      {
        "ordinal": 2,
        "name": "created!",
        "type_info": "Timestamp"
      },
      {
        "ordinal": 3,
        "name": "updated!",
        "type_info": "Timestamp"
      },
      {
        "ordinal": 4,
        "name": "tx_lt!",
        "type_info": "Int8"
      },
      {
        "ordinal": 5,
        "name": "nft!",
        "type_info": "Varchar"
      },
      {
        "ordinal": 6,
        "name": "collection?",
        "type_info": "Varchar"
      },
      {
        "ordinal": 7,
        "name": "buyer?",
        "type_info": "Varchar"
      },
      {
        "ordinal": 8,
        "name": "price_token!",
        "type_info": "Varchar"
      },
      {
        "ordinal": 9,
        "name": "price!",
        "type_info": "Numeric"
      },
      {
        "ordinal": 10,
        "name": "finished_at?",
        "type_info": "Timestamp"
      },
      {
        "ordinal": 11,
        "name": "expired_at?",
        "type_info": "Timestamp"
      },
      {
        "ordinal": 12,
        "name": "state!: _",
        "type_info": {
          "Custom": {
            "name": "direct_buy_state",
            "kind": {
              "Enum": [
                "create",
                "await_tokens",
                "active",
                "filled",
                "cancelled",
                "expired"
              ]
            }
          }
        }
      },
      {
        "ordinal": 13,
        "name": "cnt!",
        "type_info": "Int8"
      },
      {
        "ordinal": 14,
        "name": "fee_numerator",
        "type_info": "Int4"
      },
      {
        "ordinal": 15,
        "name": "fee_denominator",
        "type_info": "Int4"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Text"
      ]
    },
    "nullable": [
      null,
      false,
      false,
      false,
      false,
      false,
      true,
      false,
      false,
      false,
      true,
      false,
      null,
      null,
      null,
      null
    ]
  },
  "hash": "c92350e4b1f274f8eb758f3efd6d54ffa60c1928cf9494f0517b754c8bd9f600"
}
